<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WebCHATO</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/3.0.4/socket.io.js"></script>


</head>

<body>
    <h2 data-testid="online-user" id='nickHash'></h2>



    <form id="mensageInputForm" action="">
        <label for="mensagemInput">Mensage</label>
        <input id="mensagemInput" data-testid="message-box"></input>
        <button data-testid="send-button">Send-Mensage</button>
    </form>

    <form id="changeNickName" action="">
        <label for="nickBox">Input your nickname</label>
        <input id="nickBox" data-testid="nickname-box"></input>
        <button data-testid="nickname-button">Change-Nick</button>
    </form>

    <ul id="mensagens"></ul>

</body>

<script>
    // a função io por padrao roda no localhost mas caso queira alterar e só parar o parametro
    // Ajuda de diegho para relembrar topicos relacionados a Dom/Queries
    const createUser = (newNick) => {
        const userH2 = document.querySelector('#nickHash')
        userH2.innerText = newNick
    }
    const socket = io()
    socket.on('login', (newAletorieNick) => {
        createUser(newAletorieNick)
    })

    const formMensage = document.querySelector('#mensageInputForm')
    const inputMensage = document.querySelector('#mensagemInput')
    const formNickname = document.querySelector('#changeNickName')
    const inputNickname = document.querySelector('#nickBox')
    const hash = document.querySelector('#nickHash')

    formNickname.addEventListener('click', (event) => {
        event.preventDefault();
        hash.innerText = inputNickname.value
        inputNickname.value = ''

    })


    formMensage.addEventListener('submit', (event) => {
        // pagina não deve ser atualizada com rpevent default
        event.preventDefault()
        // Emitindo!
        socket.emit('message', {
            chatMessage: inputMensage.value,
            nickname: document.querySelector('#nickHash').innerText
        })
        return false
    })


    const createMessage = (message) => {
        const messagesUl = document.querySelector('#mensagens');
        const li = document.createElement('li');
        li.setAttribute('data-testid', "message")
        li.innerText = `${message}`;
        messagesUl.appendChild(li);
    };

    socket.on('message', (message) => {
        createMessage(message)
    })
</script>

</html>